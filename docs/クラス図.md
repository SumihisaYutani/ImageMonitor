# ImageMonitor ã‚¯ãƒ©ã‚¹å›³

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦ã‚¯ãƒ©ã‚¹å›³

```mermaid
classDiagram
    %% Main Application Entry Point
    class App {
        +IHost AppHost
        +ShutdownMode ShutdownMode
        +OnStartup()
        +ConfigureServices()
        +OnExit()
    }
    
    %% Main Window and UI
    class MainWindow {
        +MainViewModel ViewModel
        +LoadWindowStateAsync()
        +Settings_Click()
        +Exit_Click()
        +OptimizeDatabase_Click()
        +About_Click()
        +ClearSearch_Click()
        +SearchTextBox_KeyDown()
        +Properties_Click()
    }
    
    class SettingsWindow {
        +SettingsViewModel ViewModel
        +SaveSettings_Click()
        +Cancel_Click()
        +AddDirectory_Click()
        +RemoveDirectory_Click()
    }
    
    %% ViewModels (MVVM Pattern)
    class MainViewModel {
        +ObservableCollection~IDisplayItem~ DisplayItems
        +IDisplayItem SelectedDisplayItem
        +string SearchQuery
        +int ThumbnailSize
        +string StatusText
        +int TotalItems
        +bool IsPropertiesPanelVisible
        +SortBy SortBy
        +SortDirection SortDirection
        +ICommand SearchImagesCommand
        +ICommand RefreshCommand
        +ICommand ScanImagesCommand
        +ICommand OpenImageCommand
        +ICommand OpenFolderCommand
        +ICommand ToggleSortDirectionCommand
        +ICommand RandomizeDisplayCommand
        +LoadImageItemsAsync()
        +LoadRemainingItemsAsync()
        +SearchImagesAsync()
        +SearchArchiveItemsAsync()
        +OpenImageAsync()
        +OpenFolderAsync()
        +RandomizeDisplayAsync()
        -Dictionary~string,IEnumerable~ArchiveItem~~ _searchCache
        -ApplyUILevelSort(IEnumerable~IDisplayItem~)
    }
    
    class SettingsViewModel {
        +ObservableCollection~string~ ScanDirectories
        +int ThumbnailSize
        +string DefaultArchiveViewer
        +int Theme
        +List~string~ SupportedImageFormats
        +List~string~ SupportedArchiveFormats
        +bool GenerateArchiveThumbnails
        +int MaxArchiveEntries
        +int MaxConcurrentScans
        +int ScanTimeout
        +ICommand AddDirectoryCommand
        +ICommand RemoveDirectoryCommand
        +LoadSettingsAsync()
        +SaveSettingsAsync()
    }
    
    %% Models
    class ImageItem {
        +string Id
        +string FilePath
        +string FileName
        +long FileSize
        +DateTime CreatedAt
        +DateTime ModifiedAt
        +int Width
        +int Height
        +string ImageFormat
        +string ThumbnailPath
        +bool IsArchived
        +string ArchivePath
        +DateTime? DateTaken
        +bool HasExifData
        +string Hash
        +string DisplayName
        +string Resolution
        +string FormattedFileSize
    }
    
    class ArchiveItem {
        +string Id
        +string FilePath
        +string FileName
        +long FileSize
        +DateTime CreatedAt
        +DateTime ModifiedAt
        +int ImageFiles
        +string ThumbnailPath
        +string Hash
        +string DisplayName
        +string Resolution
        +string FormattedFileSize
    }
    
    class ScanHistory {
        +string Id
        +DateTime ScanStartTime
        +DateTime? ScanEndTime
        +int TotalFilesScanned
        +int NewFilesAdded
        +int UpdatedFiles
        +int ErrorCount
        +string ScanPath
        +string Status
    }
    
    class AppSettings {
        +List~string~ ScanDirectories
        +int ThumbnailSize
        +string DefaultArchiveViewer
        +int Theme
        +List~string~ SupportedImageFormats
        +List~string~ SupportedArchiveFormats
        +bool GenerateArchiveThumbnails
        +int MaxArchiveEntries
        +double WindowWidth
        +double WindowHeight
        +bool WindowMaximized
        +int MaxConcurrentScans
        +int ScanTimeout
        +int ThumbnailCacheSize
        +int CacheCleanupInterval
        +bool EnableThumbnailGeneration
        +bool EnableLogging
        +string LogLevel
        +int MaxLogFiles
    }
    
    class SearchFilter {
        +string Query
        +long? MinFileSize
        +long? MaxFileSize
        +DateTime? DateFrom
        +DateTime? DateTo
        +int? MinWidth
        +int? MaxWidth
        +int? MinHeight
        +int? MaxHeight
        +bool IncludeArchives
        +double ImageRatioThreshold
        +List~string~ ImageFormats
        +bool? HasExifData
        +DateTime? DateTakenFrom
        +DateTime? DateTakenTo
        +SortBy SortBy
        +SortDirection SortDirection
        +int PageSize
        +int PageNumber
    }
    
    %% Interfaces
    class IDisplayItem {
        <<interface>>
        +string Id
        +string FilePath
        +string FileName
        +long FileSize
        +DateTime CreatedAt
        +DateTime ModifiedAt
        +string ThumbnailPath
        +string DisplayName
        +string Resolution
        +string FormattedFileSize
    }
    
    %% Services
    class IDatabaseService {
        <<interface>>
        +InitializeDatabaseAsync()
        +AddImageItemAsync(ImageItem)
        +AddArchiveItemAsync(ArchiveItem)
        +GetImageItemsAsync(int, int)
        +GetArchiveItemsAsync(int, int)
        +SearchImageItemsAsync(SearchFilter)
        +SearchArchiveItemsAsync(SearchFilter)
        +UpdateImageItemAsync(ImageItem)
        +UpdateArchiveItemAsync(ArchiveItem)
        +DeleteImageItemAsync(string)
        +DeleteArchiveItemAsync(string)
        +GetTotalCountAsync()
        +OptimizeDatabaseAsync()
    }
    
    class DatabaseService {
        -LiteDatabase _database
        -ILogger~DatabaseService~ _logger
        +InitializeDatabaseAsync()
        +AddImageItemAsync(ImageItem)
        +AddArchiveItemAsync(ArchiveItem)
        +GetImageItemsAsync(int, int)
        +GetArchiveItemsAsync(int, int)
        +GetArchiveItemCountAsync()
        +GetImageItemCountAsync()
        +SearchImageItemsAsync(SearchFilter)
        +SearchArchiveItemsAsync(SearchFilter)
        +CleanupSingleImageItemsAsync()
        +CleanupDeletedDirectoriesAsync()
        +DetectDeletedDirectoriesAsync()
        +UpdateImageItemAsync(ImageItem)
        +UpdateArchiveItemAsync(ArchiveItem)
        +DeleteImageItemAsync(string)
        +DeleteArchiveItemAsync(string)
        +GetTotalCountAsync()
        +OptimizeDatabaseAsync()
        -ApplySearchFilter(ILiteQueryable, SearchFilter)
        -CreateIndexes()
    }
    
    class IConfigurationService {
        <<interface>>
        +GetSettingsAsync()
        +SaveSettingsAsync(AppSettings)
    }
    
    class ConfigurationService {
        -string _settingsFilePath
        -ILogger~ConfigurationService~ _logger
        +GetSettingsAsync()
        +SaveSettingsAsync(AppSettings)
        -GetDefaultSettings()
    }
    
    class IImageScanService {
        <<interface>>
        +ScanDirectoriesAsync(List~string~)
        +ScanDirectoryAsync(string)
    }
    
    class ImageScanService {
        -IDatabaseService _databaseService
        -IThumbnailService _thumbnailService
        -IConfigurationService _configurationService
        -ILogger~ImageScanService~ _logger
        +ScanDirectoriesAsync(List~string~)
        +ScanDirectoryAsync(string)
        -ProcessImageFileAsync(string)
        -ProcessArchiveFileAsync(string)
        -IsImageFile(string)
        -IsArchiveFile(string)
    }
    
    class IThumbnailService {
        <<interface>>
        +GenerateThumbnailAsync(string, int)
        +GenerateArchiveThumbnailAsync(string, int)
        +GetThumbnailPathAsync(string, int)
    }
    
    class ThumbnailService {
        -string _thumbnailCacheDirectory
        -ILogger~ThumbnailService~ _logger
        -IConfigurationService _configService
        -SemaphoreSlim _operationLock
        -ConcurrentDictionary _pendingThumbnails
        -ConcurrentDictionary _thumbnailCache
        +GenerateThumbnailAsync(string, int)
        +GenerateArchiveThumbnailAsync(string, int)
        +GetThumbnailPathAsync(string, int)
        -CreateThumbnailDirectory(int)
        -GenerateThumbnailInternalAsync(string, string, int)
        -GenerateThumbnailFromStreamAsync(Stream, string, int, string)
        -GenerateZipThumbnailAsync(string, string, int)
        -GenerateRarThumbnailAsync(string, string, int)
        -ExtractArchiveImage(string)
    }
    
    class LauncherService {
        -ILogger~LauncherService~ _logger
        +LaunchAssociatedAppAsync(string)
        +OpenFolderAndSelectFileAsync(string)
    }
    
    class IMessagingService {
        <<interface>>
        +ShowMessageAsync(string, string, MessageType)
        +ShowConfirmationAsync(string, string)
    }
    
    class MessagingService {
        +ShowMessageAsync(string, string, MessageType)
        +ShowConfirmationAsync(string, string)
    }
    
    %% Converters
    class ThumbnailSizeToCardSizeConverter {
        +Convert(object, Type, object, CultureInfo)
        +ConvertBack(object, Type, object, CultureInfo)
    }
    
    %% Enums
    class SortBy {
        <<enumeration>>
        FileName
        FileSize
        CreatedAt
        ModifiedAt
        Width
        Height
    }
    
    class SortDirection {
        <<enumeration>>
        Ascending
        Descending
    }
    
    class MessageType {
        <<enumeration>>
        Information
        Warning
        Error
        Question
    }
    
    %% Relationships
    App --> MainWindow : creates
    App --> IConfigurationService : uses
    App --> IDatabaseService : uses
    
    MainWindow --> MainViewModel : binds
    SettingsWindow --> SettingsViewModel : binds
    
    MainViewModel --> IDatabaseService : uses
    MainViewModel --> IImageScanService : uses
    MainViewModel --> LauncherService : uses
    MainViewModel --> IMessagingService : uses
    MainViewModel --> IDisplayItem : manages
    
    SettingsViewModel --> IConfigurationService : uses
    
    DatabaseService ..|> IDatabaseService : implements
    ConfigurationService ..|> IConfigurationService : implements
    ImageScanService ..|> IImageScanService : implements
    ThumbnailService ..|> IThumbnailService : implements
    MessagingService ..|> IMessagingService : implements
    
    ImageItem ..|> IDisplayItem : implements
    ArchiveItem ..|> IDisplayItem : implements
    
    ImageScanService --> IDatabaseService : uses
    ImageScanService --> IThumbnailService : uses
    ImageScanService --> IConfigurationService : uses
    
    MainViewModel --> SearchFilter : creates
    DatabaseService --> ImageItem : manages
    DatabaseService --> ArchiveItem : manages
    DatabaseService --> ScanHistory : manages
    
    ConfigurationService --> AppSettings : manages
```

## ä¸»è¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®è²¬å‹™

### 1. Presentation Layer (UI)
- **MainWindow**: ãƒ¡ã‚¤ãƒ³ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã®UIåˆ¶å¾¡
- **SettingsWindow**: è¨­å®šç”»é¢ã®UIåˆ¶å¾¡
- **MainViewModel**: ãƒ¡ã‚¤ãƒ³ç”»é¢ã®ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯
- **SettingsViewModel**: è¨­å®šç”»é¢ã®ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯

### 2. Service Layer (ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯)
- **DatabaseService**: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ“ä½œã®å®Ÿè£…
- **ConfigurationService**: è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®ç®¡ç†
- **ImageScanService**: ç”»åƒãƒ»ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¹ã‚­ãƒ£ãƒ³
- **ThumbnailService**: ã‚µãƒ ãƒã‚¤ãƒ«ç”»åƒã®ç”Ÿæˆãƒ»ç®¡ç†
- **LauncherService**: å¤–éƒ¨ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®èµ·å‹•
- **MessagingService**: ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤ºã®ç®¡ç†

### 3. Model Layer (ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«)
- **ImageItem**: ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã®æƒ…å ±
- **ArchiveItem**: ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ãƒ•ã‚¡ã‚¤ãƒ«ã®æƒ…å ±
- **ScanHistory**: ã‚¹ã‚­ãƒ£ãƒ³å±¥æ­´
- **AppSettings**: ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®š
- **SearchFilter**: æ¤œç´¢æ¡ä»¶

### 4. Infrastructure Layer
- **IDisplayItem**: è¡¨ç¤ºã‚¢ã‚¤ãƒ†ãƒ ã®å…±é€šã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
- **ThumbnailSizeToCardSizeConverter**: WPFç”¨ã®å€¤ã‚³ãƒ³ãƒãƒ¼ã‚¿ãƒ¼

## æ¤œç´¢æ©Ÿèƒ½ã®ã‚¯ãƒ©ã‚¹ç›¸äº’ä½œç”¨

```mermaid
sequenceDiagram
    participant UI as MainWindow
    participant VM as MainViewModel
    participant DB as DatabaseService
    participant Cache as SearchCache
    
    UI->>+VM: SearchTextBox_KeyDown (Enter)
    VM->>VM: SearchImagesCommand.Execute()
    VM->>+Cache: TryGetValue(cacheKey)
    
    alt Cache Hit
        Cache-->>-VM: cachedResults
        VM->>VM: CreateDisplayItems
        VM->>UI: Update DisplayItems
    else Cache Miss
        VM->>+DB: SearchArchiveItemsAsync(filter)
        DB->>DB: Execute LiteDB query
        DB->>DB: Apply sorting in memory
        DB->>DB: Apply pagination
        DB-->>-VM: searchResults
        VM->>+Cache: Store results
        Cache-->>-VM: cached
        VM->>VM: CreateDisplayItems
        VM->>UI: Update DisplayItems
    end
```

## ä¾å­˜æ€§æ³¨å…¥ã®æ§‹æˆ

```mermaid
graph TD
    A[App.ConfigureServices] --> B[IDatabaseService â†’ DatabaseService]
    A --> C[IConfigurationService â†’ ConfigurationService]
    A --> D[IImageScanService â†’ ImageScanService]
    A --> E[IThumbnailService â†’ ThumbnailService]
    A --> F[IMessagingService â†’ MessagingService]
    A --> G[LauncherService]
    A --> H[MainWindow]
    A --> I[SettingsWindow]
    A --> J[MainViewModel]
    A --> K[SettingsViewModel]
    
    J --> B
    J --> D
    J --> G
    J --> F
    
    K --> C
    
    D --> B
    D --> E
    D --> C
    
    style A fill:#e1f5fe
    style B fill:#fff3e0
    style C fill:#fff3e0
    style D fill:#fff3e0
    style E fill:#fff3e0
    style F fill:#fff3e0
```

## WebPã‚µãƒãƒ¼ãƒˆè¿½åŠ ã«ã‚ˆã‚‹ä¸»è¦ã‚¯ãƒ©ã‚¹å¤‰æ›´ï¼ˆ2025-09-07ï¼‰

### å¤‰æ›´ã•ã‚ŒãŸã‚¯ãƒ©ã‚¹

1. **ThumbnailService**ï¼š
   - `GenerateThumbnailFromStreamAsync`ãƒ¡ã‚½ãƒƒãƒ‰ã«`fileExtension`ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’è¿½åŠ 
   - WebPç”¨ã®ä¾‹å¤–ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ï¼ˆNotSupportedException, FileFormatExceptionï¼‰ã‚’å®Ÿè£…
   - ZIP/RARå‡¦ç†ã§ã®ãƒ•ã‚¡ã‚¤ãƒ«æ‹¡å¼µå­å–å¾—ãƒ»ä¼é”ã®å¼·åŒ–

2. **MainViewModel**ï¼š
   - `LoadRemainingItemsAsync`ãƒ¡ã‚½ãƒƒãƒ‰ã®è¿½åŠ ï¼ˆãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰èª­ã¿è¾¼ã¿ï¼‰
   - `ApplyUILevelSort`ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒ¡ã‚½ãƒƒãƒ‰ã®è¿½åŠ ï¼ˆUIãƒ¬ãƒ™ãƒ«ã‚½ãƒ¼ãƒˆï¼‰
   - æ¤œç´¢çµæœã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿèƒ½ã®å¼·åŒ–

3. **App**ï¼š
   - `ShutdownMode`ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®ç®¡ç†è¿½åŠ 
   - é‡è¤‡ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦è¡¨ç¤ºå•é¡Œã®ä¿®æ­£

4. **AppSettings**ï¼š
   - `SupportedImageFormats`ã«WebPå½¢å¼ï¼ˆ.webpï¼‰ã‚’è¿½åŠ 

### å‰Šé™¤ã•ã‚ŒãŸã‚¯ãƒ©ã‚¹ãƒ»ãƒ¡ã‚½ãƒƒãƒ‰
- ãªã—ï¼ˆæ—¢å­˜æ©Ÿèƒ½ã¯ã™ã¹ã¦ä¿æŒã€æ‹¡å¼µã®ã¿ï¼‰

### æ–°ã—ã„ä¾å­˜é–¢ä¿‚
- ThumbnailService â†’ ãƒ•ã‚¡ã‚¤ãƒ«æ‹¡å¼µå­æƒ…å ±ï¼ˆã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã‚¨ãƒ³ãƒˆãƒªã‹ã‚‰ï¼‰
- MainViewModel â†’ UIãƒ¬ãƒ™ãƒ«ã‚½ãƒ¼ãƒˆæ©Ÿèƒ½
- æ—¢å­˜ã®ä¾å­˜é–¢ä¿‚ã¯å¤‰æ›´ãªã—

---

## v1.1.0 æœ€æ–°æ©Ÿèƒ½å®Ÿè£…ã«ã‚ˆã‚‹ã‚¯ãƒ©ã‚¹å¤‰æ›´ï¼ˆ2025-10-26ï¼‰

### ä¸»è¦ãªã‚¯ãƒ©ã‚¹æ©Ÿèƒ½æ‹¡å¼µ

#### 1. **MainViewModel** - ãƒ©ãƒ³ãƒ€ãƒ è¡¨ç¤ºã¨ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãƒ‘ãƒãƒ«åˆ¶å¾¡
```csharp
// æ–°è¦è¿½åŠ ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£
+bool IsPropertiesPanelVisible  // ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãƒ‘ãƒãƒ«è¡¨ç¤ºåˆ¶å¾¡
+ICommand RandomizeDisplayCommand  // ãƒ©ãƒ³ãƒ€ãƒ è¡¨ç¤ºã‚³ãƒãƒ³ãƒ‰

// æ–°è¦è¿½åŠ ãƒ¡ã‚½ãƒƒãƒ‰
+RandomizeDisplayAsync()  // ãƒ©ãƒ³ãƒ€ãƒ è¡¨ç¤ºå®Ÿè£…
+SearchArchiveItemsAsync()  // ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–å°‚ç”¨æ¤œç´¢
```

#### 2. **DatabaseService** - é«˜é€ŸåŒ–ã¨ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—æ©Ÿèƒ½
```csharp
// ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ”¹å–„ãƒ¡ã‚½ãƒƒãƒ‰
+GetArchiveItemCountAsync()  // ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–æ•°å–å¾—
+GetImageItemCountAsync()  // ç”»åƒæ•°å–å¾—

// ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—æ©Ÿèƒ½
+CleanupSingleImageItemsAsync()  // å˜ä¸€ç”»åƒå‰Šé™¤
+DetectDeletedDirectoriesAsync()  // å‰Šé™¤ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ¤œå‡º
+CleanupDeletedDirectoriesAsync()  // å‰Šé™¤ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
```

#### 3. **ThumbnailService** - è¤‡æ•°ç”»åƒãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
```csharp
// å¼·åŒ–ã•ã‚ŒãŸã‚µãƒ ãƒã‚¤ãƒ«ç”Ÿæˆ
+GenerateThumbnailFromStreamAsync(Stream, string, int, string)  // WebPå¯¾å¿œ
-ComplexImageFallbackLogic()  // è¤‡æ•°ç”»åƒè©¦è¡Œãƒ­ã‚¸ãƒƒã‚¯
```

#### 4. **ImageScanService** - è¶…é«˜é€Ÿã‚¹ã‚­ãƒ£ãƒ³
```csharp
// ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–
-SemaphoreSlim _scanSemaphore  // ä¸¦è¡Œåˆ¶å¾¡å¼·åŒ–
-PopulateImageMetadataFromStream()  // â€»å‰Šé™¤ï¼ˆé«˜é€ŸåŒ–ã®ãŸã‚ï¼‰
+OptimizedArchiveProcessing()  // æœ€é©åŒ–ã•ã‚ŒãŸã‚¢ãƒ¼ã‚«ã‚¤ãƒ–å‡¦ç†
```

### æ–°æ©Ÿèƒ½ã®ã‚·ãƒ¼ã‚±ãƒ³ã‚¹å›³

#### ãƒ©ãƒ³ãƒ€ãƒ è¡¨ç¤ºæ©Ÿèƒ½
```mermaid
sequenceDiagram
    participant U as User
    participant MV as MainViewModel
    participant DB as DatabaseService
    participant UI as MainWindow
    
    U->>UI: ğŸ²ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯
    UI->>MV: RandomizeDisplayCommand.Execute()
    MV->>DB: GetArchiveItemsAsync()
    DB-->>MV: ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ãƒªã‚¹ãƒˆ
    MV->>MV: Random.Shuffle()
    MV->>UI: DisplayItemsæ›´æ–°
    UI-->>U: ãƒ©ãƒ³ãƒ€ãƒ é †ã§è¡¨ç¤º
```

#### ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãƒ‘ãƒãƒ«åˆ‡ã‚Šæ›¿ãˆ
```mermaid
sequenceDiagram
    participant U as User
    participant MV as MainViewModel
    participant UI as MainWindow
    
    U->>UI: ğŸ“‹Propertiesãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯
    UI->>MV: IsPropertiesPanelVisibleåˆ‡ã‚Šæ›¿ãˆ
    MV->>UI: PropertyChangedé€šçŸ¥
    UI->>UI: BooleanToVisibilityConverter
    UI-->>U: ãƒ‘ãƒãƒ«è¡¨ç¤º/éè¡¨ç¤º
```

### ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®æ”¹å–„ç‚¹

1. **ä¸¦è¡Œå‡¦ç†æœ€é©åŒ–**: SemaphoreSlimã«ã‚ˆã‚‹é©åˆ‡ãªåŒæ™‚å®Ÿè¡Œåˆ¶é™
2. **ãƒ¡ãƒ¢ãƒªåŠ¹ç‡åŒ–**: ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿å‡¦ç†ã®å‰Šé™¤ã«ã‚ˆã‚‹ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡å‰Šæ¸›
3. **æ¤œç´¢ã‚­ãƒ£ãƒƒã‚·ãƒ¥**: Dictionary\<string, IEnumerable\<ArchiveItem\>\>ã«ã‚ˆã‚‹é«˜é€Ÿå†æ¤œç´¢
4. **ã‚¨ãƒ©ãƒ¼è€æ€§**: è¤‡æ•°ç”»åƒãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã«ã‚ˆã‚‹ã‚µãƒ ãƒã‚¤ãƒ«ç”ŸæˆæˆåŠŸç‡å‘ä¸Š
5. **UIå¿œç­”æ€§**: ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰å‡¦ç†ã¨ãƒ—ãƒ­ã‚°ãƒ¬ãƒƒã‚·ãƒ–ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æŒ‡æ¨™
- **ã‚¹ã‚­ãƒ£ãƒ³é€Ÿåº¦**: 40ç§’ â†’ 0.6ç§’ï¼ˆ99%æ”¹å–„ï¼‰
- **ä¸¦è¡Œå‡¦ç†**: æœ€å¤§16ã‚¿ã‚¹ã‚¯åŒæ™‚å®Ÿè¡Œ
- **æ¤œç´¢é€Ÿåº¦**: ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«ã‚ˆã‚Š1ç§’ä»¥ä¸‹
- **ãƒ¡ãƒ¢ãƒªåŠ¹ç‡**: å¤§å¹…å‰Šæ¸›ï¼ˆå…·ä½“å€¤ã¯é‹ç”¨æ™‚æ¸¬å®šï¼‰